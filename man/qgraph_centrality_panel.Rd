\name{qgraph_centrality_panel}
\alias{qgraph_centrality_panel}
\title{Combine a qgraph Network Plot with a Centrality Panel}

\description{
The \code{qgraph_centrality_panel} function creates a side-by-side visualization combining a
network graph rendered by \code{qgraph} (left panel) with a \code{ggplot2} centrality or bridge plot
(right panel), such as those generated by \code{centrality_duo_plot()}.
It allows flexible control over label presentation, resolution, legend layout, and relative panel widths,
producing publication-ready composite figures for psychometric network analysis.

\strong{Key Features}:
\itemize{
\item Combines a network visualization (\code{qgraph}) with a centrality plot (\code{ggplot2}) into one cohesive panel.
\item Supports node grouping (\code{groups}) and pie indicators (e.g., measurement error proportions).
\item Allows abbreviation or custom labeling of node names for compact visualization.
\item Uses \code{patchwork} to control layout, legend position, and width ratios.
\item Automatically exports the \code{qgraph} panel to a temporary PNG via \code{CairoPNG()} for seamless integration.
\item Returns a single composited plot with unified legends positioned at the bottom.
}
}

\usage{
qgraph_centrality_panel(
  Figura1_Derecha,
  network,
  groups,
  error_Model,
  labels = NULL,
  abbreviate_labels = FALSE,
  ncol = 2,
  widths = c(0.50, 0.60),
  dpi = 600,
  legend.cex = 0.1,
  legend_title = "Métrica",
  keep_centrality_scale = TRUE
)
}

\arguments{
\item{\code{Figura1_Derecha}}{A \code{ggplot2} object representing the right-hand panel (usually from \code{centrality_duo_plot()}).}
\item{\code{network}}{A network object (typically from \code{bootnet::estimateNetwork}) containing the adjacency matrix in \code{network\$graph}.}
\item{\code{groups}}{A vector defining community or grouping membership for nodes; used by \code{qgraph} to color groups.}
\item{\code{error_Model}}{Optional data used in the \code{pie} argument of \code{qgraph()} to display node-level information (e.g., error proportions).}
\item{\code{labels}}{Optional character vector providing custom node labels. If \code{NULL}, labels are taken from \code{network\$labels}.}
\item{\code{abbreviate_labels}}{Logical; if \code{TRUE}, labels are abbreviated to the first three characters. Default is \code{FALSE}.}
\item{\code{ncol}}{Integer specifying the number of columns for the combined figure layout. Default is \code{2}.}
\item{\code{widths}}{Numeric vector controlling the relative widths of the left (\code{qgraph}) and right (\code{ggplot2}) panels. Default is \code{c(0.50, 0.60)}.}
\item{\code{dpi}}{Integer resolution (in dots per inch) for rendering the temporary \code{qgraph} PNG. Default is \code{600}.}
\item{\code{legend.cex}}{Numeric value controlling the relative size of legends in the \code{qgraph} panel. Default is \code{0.1}.}
\item{\code{legend_title}}{Character string for the title of the color legend in the combined figure. Default is \code{"Métrica"}.}
\item{\code{keep_centrality_scale}}{Logical; if \code{TRUE}, preserves the axis scaling of the centrality plot. Default is \code{TRUE}.}
}

\details{
This function automates the creation of dual-panel figures that juxtapose the structural network
representation and its node-level metrics. Internally, it:
\enumerate{
\item Renders the \code{qgraph} network to a temporary PNG file using the \code{Cairo} graphics engine.
\item Imports the rendered image via \code{png::readPNG()} and embeds it as a raster grob within a \code{ggplot2} canvas.
\item Combines the rasterized network plot with a user-provided \code{ggplot2} object (\code{Figura1_Derecha}) using \code{patchwork::plot_layout()}.
\item Aligns legends across both panels and places them collectively below the figure.
}

The function is particularly useful for reporting results from network psychometrics,
where both the structural map and centrality indicators are displayed together for interpretability.

\strong{Technical Note:}
Temporary image files are automatically deleted upon function exit.
Package dependencies (\code{ggplot2}, \code{qgraph}, \code{png}, \code{grid}, \code{patchwork}, \code{Cairo})
are checked and loaded at runtime.
}

\value{
A composited \code{ggplot2}/\code{patchwork} object that displays:
\itemize{
  \item Left panel: \code{qgraph} network with group colors and optional pie indicators.
  \item Right panel: Centrality or bridge metric plot.
  \item Shared legend below both panels.
}
}

\examples{
\dontrun{
# Example combining network and centrality plots
combo_plot <- qgraph_centrality_panel(
  Figura1_Derecha = centrality_result$plot,
  network = net_estimate,
  groups = c(1,1,2,2,3,3),
  error_Model = list(c(0.2, 0.8), c(0.4, 0.6), c(0.3, 0.7)),
  labels = c("Agotamiento", "Hartazgo", "Control", "Satisfacción", "Apoyo", "Carga"),
  abbreviate_labels = TRUE,
  legend_title = "Centralidad"
)

print(combo_plot)
}
}

\author{
Dr. José Ventura-León
}
